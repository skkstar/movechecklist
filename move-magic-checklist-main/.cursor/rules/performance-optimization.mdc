---
globs: *.tsx,*.ts
description: Performance optimization guidelines
---

# âš¡ Performance Optimization

## ðŸŽ¯ React Performance Rules
- âœ… **Memoization**: Use `React.memo`, `useMemo`, `useCallback`
- âœ… **Code Splitting**: Lazy load components and routes
- âœ… **Bundle Optimization**: Tree shaking and dead code elimination
- âœ… **Image Optimization**: Use proper formats and lazy loading
- âŒ **Avoid unnecessary re-renders**

## ðŸ§  Memoization Patterns
```typescript
// âœ… Memoized Component
const ChecklistCard = React.memo(({ item, onToggle }: Props) => {
  return (
    <Card>
      {/* Component content */}
    </Card>
  );
});

// âœ… Memoized Callbacks
const ChecklistSection = ({ items }: Props) => {
  const handleToggle = useCallback(async (id: string) => {
    await toggleItem(id);
  }, []);

  const filteredItems = useMemo(() => {
    return items.filter(item => !item.completed);
  }, [items]);

  return (
    <div>
      {filteredItems.map(item => (
        <ChecklistCard 
          key={item.id} 
          item={item} 
          onToggle={handleToggle} 
        />
      ))}
    </div>
  );
};
```

## ðŸš€ Code Splitting & Lazy Loading
```typescript
// âœ… Lazy Route Loading
const Moving = lazy(() => import('./pages/Moving'));
const Furniture = lazy(() => import('./pages/Furniture'));

// âœ… Suspense Wrapper
<Suspense fallback={<div>Loading...</div>}>
  <Routes>
    <Route path="/moving" element={<Moving />} />
    <Route path="/furniture" element={<Furniture />} />
  </Routes>
</Suspense>

// âœ… Dynamic Imports
const loadHeavyComponent = async () => {
  const { HeavyComponent } = await import('./HeavyComponent');
  return HeavyComponent;
};
```

## ðŸ–¼ï¸ Image Optimization
```typescript
// âœ… Optimized Image Component
const OptimizedImage = ({ src, alt, ...props }) => {
  const [isLoaded, setIsLoaded] = useState(false);
  
  return (
    <div className="relative">
      {!isLoaded && (
        <div className="absolute inset-0 bg-muted animate-pulse" />
      )}
      <img
        src={src}
        alt={alt}
        onLoad={() => setIsLoaded(true)}
        className={`transition-opacity ${isLoaded ? 'opacity-100' : 'opacity-0'}`}
        {...props}
      />
    </div>
  );
};

// âœ… Lazy Loading Images
<img
  src={imageSrc}
  alt={alt}
  loading="lazy"
  className="w-full h-auto"
/>
```

## ðŸ“Š Bundle Optimization
```typescript
// âœ… Tree Shaking - Import only what you need
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
// âŒ Avoid: import * from '@/components/ui';

// âœ… Dynamic Imports for Heavy Libraries
const loadChartLibrary = async () => {
  const { Chart } = await import('chart.js');
  return Chart;
};

// âœ… Conditional Imports
if (process.env.NODE_ENV === 'development') {
  const { whyDidYouRender } = await import('@welldone-software/why-did-you-render');
  whyDidYouRender(React);
}
```

## ðŸ”„ State Management Optimization
```typescript
// âœ… Optimized State Updates
const [items, setItems] = useState<Item[]>([]);

// Use functional updates to avoid stale closures
const updateItem = useCallback((id: string, updates: Partial<Item>) => {
  setItems(prev => prev.map(item => 
    item.id === id ? { ...item, ...updates } : item
  ));
}, []);

// âœ… Debounced Search
const useDebounce = (value: string, delay: number) => {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => clearTimeout(handler);
  }, [value, delay]);

  return debouncedValue;
};
```

## ðŸ“± Mobile Performance
- **Touch Optimization**: Proper touch targets (44px minimum)
- **Scroll Performance**: Use `transform` instead of changing layout properties
- **Memory Management**: Clean up event listeners and subscriptions
- **Battery Optimization**: Minimize animations and background processes

## ðŸŽ¯ Performance Monitoring
```typescript
// âœ… Performance Metrics
const measurePerformance = (name: string, fn: () => void) => {
  const start = performance.now();
  fn();
  const end = performance.now();
  console.log(`${name} took ${end - start} milliseconds`);
};

// âœ… React DevTools Profiler
import { Profiler } from 'react';

const onRenderCallback = (id, phase, actualDuration) => {
  console.log('Render:', { id, phase, actualDuration });
};

<Profiler id="ChecklistSection" onRender={onRenderCallback}>
  <ChecklistSection />
</Profiler>
```